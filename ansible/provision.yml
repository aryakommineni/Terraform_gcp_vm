- name: Create GCP VM
  google.cloud.gcp_compute_instance:
    name: "{{ vm_name }}"
    machine_type: "{{ machine_type }}"
    zone: "{{ zone }}"
    project: "{{ project_id }}"
    disks:
      - auto_delete: true
        boot: true
        initialize_params:
          source_image: "projects/debian-cloud/global/images/family/debian-11"
    network_interfaces:
      - network: default
        access_configs:
          - name: External NAT
            type: ONE_TO_ONE_NAT
    service_accounts:
      - email: "{{ service_account_email }}"
        scopes:
          - https://www.googleapis.com/auth/cloud-platform
  auth_kind: serviceaccount
  service_account_file: "/var/lib/awx/credentials/gcp.json"
